name: "Reintegrate master"

on:
  push:
    branches:
      - master

env:
  REINTEGRATE_BRANCH_NAME: reintegrate-main

jobs:
  reintegrate-master:
    runs-on: ubuntu-latest
    timeout-minutes: 3
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          submodules: true
      - name: Switch to intermediate branch
        run: git checkout -b $REINTEGRATE_BRANCH_NAME
      - name: Create pull-request
        run: >
          gh pr create
          -l automated
          -a awildturtok,thoniTUB
          -r awildturtok,thoniTUB
          -B develop
          --title "Reintegrate Main"
          --head $REINTEGRATE_BRANCH_NAME
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Modify pull request
        run: >
          gh pr merge
          --auto
          --delete-branch
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}